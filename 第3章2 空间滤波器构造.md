##### 空间滤波

- 低通过滤器，lowpass filter
  
  > 低频率才能通过这个过滤器

- 相关性, correlation
  
  > 相关性，就是一个关于位移的函数，是核关于图像的位移。
  
  - 一维相关性
  
  $$
  g(x) = \sum_{s=-a}^{a}w(s)f(x+s)
  $$
  
  其中，x 是核的中心，对齐到图像上的坐标 x。s 是求和变量，每次遍历整个核。
  
  所以，相关性，是核关于图像的位移的函数
  
  - 只有一个是1，其他都是0 的图像，称为离散单元脉冲
  
  - 核关于离散单元脉冲的相关性，就是核的180度翻转的。一维，二维都如此。

> 以二维为例子
> 
> 由于核的位置变化，是从左上开始，先向右，一行结束后，再第二行。
> 
> 所以，在单元脉冲图上，先感应到核右下角的信息，再邻近左一位，一行感受完，再继续倒数第二行。
> 
> 即，感受的位置顺序，和核的移动顺序是反序的。
> 
> 因此，核关于单元脉冲图的相关性，就是核的反序下标的结果，等价于核180度翻转的结果。

- 卷积
  
  > 核180度翻转+相关性 = 卷积
  > 
  > 在离散单元脉冲上，先将核180度翻转，再做相关性，得到的结果，就是核本身
  > 
  > 一维，二维的卷积，都可以视为核180度翻转，再做相关性。
  > 
  > 在二维空间中的卷积公式，称为线性空间过滤
  
  - 卷积的定义（连续函数）
    
    $$
    (f\star g)(t) \colonequals \int_{-\infin}^{\infin} f(t-\tau)g(\tau)d\tau
    $$

- 卷积，满足交换律，结合律，分配率
  
  > 交换律，分配率，可根据积分形式的定义证明
  > 
  > 结合律，基于富比尼定理可证明。

> 卷积，相关性，空间过滤器，三者常常混合使用，引起困惑。
> 
> 本书中，线性空间过滤，都是指将核在图像上做卷积

##### 可分离过滤器核

- 核，通常以矩阵形式表示，实际上，可以理解为一个函数
  
  > 可以小写字母表示 w

- 分离过滤器核矩阵，为两个向量的外积，主要是降低计算复杂度。
  
  > 降低效果明显。

##### 空间域过滤 vs 频域过滤

- 频域处理和空间域处理的关联，是傅里叶变换
  
  > 傅里叶变换：空间域 -> 频域
  > 
  > 逆傅里叶变换：频域 -> 空间域
  
  > 名词：频域的过滤转移函数(filter transfer function), 类似空间域的过滤器核(filter kernel)

---

##### 低通空间过滤器

> 即平滑过滤器

- 高斯核，是唯一一个可分离并且圆对称的核

- 当使用高斯核时，多个连续的卷积操作，可以合并成一个卷积操作
  
  > 高斯分布，只需要期望+方差，就可以唯一确定
  > 
  > 期望，一般调整为0
  > 
  > 两个高斯核做卷积，结果核的方差等于两个高斯核的方差核 
  > 
  > $\sigma_{f\star g} = \sqrt{\sigma_{f}^{2} + \sigma_{g}^{2}} $
  > 
  > 故，多个高斯核叠为一个高斯核时，只需要计算新高斯核的方差即可，而不用真的计算卷积操作

- 高斯核和 box 核相比，高斯核的模糊化更自然，更柔和

- 填充方法：
  
  - 镜像反射填充：即边界的外部是内部的镜像反射
  
  - 复制填充：即边界的外部核内部的布局一致

- 平滑效果，取决于高斯核大小 + 图像

##### 阴影纠正

- 图像阴影，主要是因为照明不均匀

- 使用低通过滤器，可以做阴影纠正
  
  > 1. 将图片做高度的高斯模糊，即高斯核卷积，即平滑效果，可将整个图片平滑为模糊效果，即近似于阴影效果
  > 
  > 2. 将图片除以模糊后的阴影值，即可增大低值像素，起到高亮的效果，使得整张图片的亮度相近，相当于去掉了光照不均匀导致的阴影

##### 椒盐噪音纠正

- 中值过滤器，可以去掉椒盐噪音。
  
  > 这是一个统计值，是非线性的过滤器

---

##### 高通空间过滤器

> 可锐化图像
> 
> 放大细节

> 导数值，可以用于表示一个像素以及邻域的变化程度
> 
> 在数字图像中的一阶导，实际是一价方向导数，是一个单向的变化率，是一个射线
> 
> $$
> \frac{\partial f}{\partial x} = f(x + 1) -f(x)
> $$
> 
> 二阶导，表示橡素和邻域的凹凸程度。考虑左右两侧
> 
> $$
> \frac{\partial^{2}f}{\partial x^2} = f(x+1) + f(x-1) - 2f(x)
> $$

- 数字图像的边缘变化，通常是斜坡式渐变。用二阶导锐化效果更好
  
  > 一阶导，只要有变化，就会有值，即使是恒定变化率，也有值。斜坡边缘显示的是一个厚边缘
  > 
  > 二阶导，只在变化率改变时，才有值，固定变化率的斜坡，没有值。所以，斜坡边缘，显示的是一个1像素宽的最窄的边缘。
  > 
  > 所以，二阶导的数据，对增强细节的效果更好！
  > 
  > 锐化，选用二阶导的数据
  
  > 拉普拉斯算子，是最简单的各向相同的二阶导算子
  > 
  > 故，可用拉普拉斯算子，做图像锐化

##### 拉普拉斯核

- 算子：是一个函数/映射，一般算子函数的定义域是函数的集合。

> 算子映射：  f -> f
> 
> 即算子映射，是函数到函数的映射。输入是一个函数，输出是另一个函数

- 微分算子：对函数做微分处理（映射）的函数
  
  > 例如一阶微分算子
  > 
  > $$
  > \frac{d}{dx}, D, D_{x}
  > $$
  > 
  > n阶微分算子
  > 
  > $$
  > \frac{d^n}{dx^n}, D^{n}
  > $$

- 拉普拉斯算子，是对输入函数做二阶求导的算子。是一个微分算子。
  
  > $$
  > \Delta = \nabla^2 = \sum_{k=1}^{n}\frac{\partial^2}{\partial x_{k}^{2}}
  > $$
  > 
  > 拉普拉斯算子 $\Delta$ ， 是对n元数值函数 f，做每个变量的二阶偏导。
  > 
  > 可以理解为是 f 的梯度的散度
  > 
  > $$
  > \begin{align*}
\Delta f&= \nabla (\nabla f)
\\&=(\frac{\partial}{\partial x},\frac{\partial}{\partial y}, \frac{\partial}{\partial z})\cdot (f_{x}', f_{y}', f_{z}')
\\&= f_{x}'' + f_{y}'' + f_{z}''
\end{align*}
  > $$

- 在数字图像 $f(x, y)$ 上，求每个位置的各项二阶导，求出图像的变化轮廓。
  
  - 即做拉普拉斯变换
  
  > $$
  > \nabla^2 f = \frac{\partial^2f}{\partial x^2} + 
\frac{\partial^2f}{\partial y^2}
  > $$
  > 
  > $$
  > \therefore \nabla^2f(x, y) = f(x+1, y)+f(x-1, y)+f(x, y+1)+f(x, y-1)-4f(x+1, y)
  > $$
  > 
  > 所以，拉普拉斯变换，是一个线性变换
  > 
  > 对输入图像，做拉普拉斯核的变换，等价于做拉普拉斯算子，即求中心位置的各向二阶导的和。
  > 
  > 拉普拉斯核：
  > 
  > $$
  > \begin{bmatrix}
0 & 1 & 0 \\
1 & -4 & 1 \\
0 & 1 & 0
\end{bmatrix}
  > $$

- 微分过滤器的核，和为0
  
  > 这样才能满足，作用于常数指区域时，卷积结果时0，即无变化值。
  > 
  > 过滤后的图像的像素值，通常会有负值，故需要再做一步处理，才能充分利用过滤后的图像。
  > 
  > 如拉普拉斯变化后的图像，加到原图像，可以强化细节轮廓，锐化细节
  > 
  > $$
  > g(x, y) = f(x, y) + c[\nabla^2f(x,y)]
  > $$
  > 
  > 其中 c 是常数

##### 非锐化掩盖， unsharp masking，即变化叠加，用于锐化

> 1. 对图像做模糊，得到平滑图
> 
> 2. 原图 - 平滑图 -> 变化图
>    
>    个人理解：得到的变化图，类似于二阶导数据，即变化率改变时有值
>    
>    近似于拉普拉斯过滤后的图像
> 
> 3. 原图 + 变化图 -> 得到锐化强化的图，增强了边缘对比
> 
> 即
> 
> $$
> g(x, y) = f(x, y) + k(f(x, y) - \bar{f}(x, y))
> $$
> 
> 其中$f$ 是原图， $\bar{f}$ 是原图模糊化后的平滑图
> 
> $k$  是可调节权重

> 个人理解：效果上，变化叠加和拉普拉斯核，应该接近。

##### 梯度图

> $$
> M(x, y) = ||grad(f)|| = \sqrt{f_{x}(x, y)^{2} + f_{y}(x, y)^{2}}
> $$
> 
> 可以用偏导数的绝对值，来近似
> 
> $$
> M(x, y) = |g_x| + |g_y|
> $$

- Sobel 算子，用于近似一阶偏导。整数计算的近似，计算简单。

- 梯度图，可以强化细微的不连续性，去掉颜色渐变区域
  
  > 可用于透明物体在视觉上的异常检测。
  > 
  > 例如，透明镜片的边缘细小缺陷

---

##### 低通过滤器 $\to$ 高通过滤器，段拒绝过滤器，段通过滤器

> 在频域，可以方便地实现过滤器的转换
> 
> 例如 $hp(x, y) = 1-  lp(x, y)$ 

##### 空间过滤器的结合

- 直方图分布调整，适合于图像本身的直方图的分布分散

- 对于以黑色，白色两个极端强度为主要的图像，更适合用幂函数变换，不适合用直方图分布调整
  
  > 人体骨骼的辐射图例子
  > 
  > $$
  > \begin{align*}
a &= origin\ image\\
b &= laplacian\ image \\
e &= sobel\ kernel + box\ filter\\
f &= b \odot e \\
g &= a + f \\
h &= g ^ n
\end{align*}
  > $$
